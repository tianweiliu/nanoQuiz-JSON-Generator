<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Question JSON Generator</title>
<script src="js/jquery-2.1.1.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
<link rel="stylesheet" href="css/redmond/jquery-ui.min.css">
<link rel="stylesheet" href="css/redmond/jquery.ui.theme.css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script src="js/jquery-ui-1.10.4.min.js"></script>
<style type="text/css">
	body {
		font-family: 'Open Sans', sans-serif;
	}
	.wrapper {
		margin:0 auto;
	}
	fieldset {
		padding:8px;
		margin:4px;
	}
	.add {
		padding:8px;
		margin:4px;
	}
	.errorMsg {
		padding:8px 8px 8px 28px;
		margin:4px;
	}
	label {
		margin:4px;
	}
	.value {
		width:99%;
		margin:4px;
		box-sizing:border-box;
	}
</style>
</head>

<body>
<div class="wrapper">
    <form>
    	<fieldset>
        	<legend>Question</legend>
            <label for="id">Question ID:</label>
            <input type="text" name="id" class="id" maxlength="200" />
            <fieldset>
                <legend>Lecture that this question belongs to</legend>
                <fieldset class="timestamp">
                    <label for="stamp">Lecture ID:</label>
                    <input type="text" name="stamp" class="stamp" maxlength="50" />
                </fieldset>
                <div class="add"><a href="#" class="addStamp">Add another lecture</a></div>
            </fieldset>
            <fieldset>
                <legend>Content</legend>
                <fieldset class="vignette">
                    <label for="contentType">Type:</label>
                    <select name="contentType" class="contentType">
                        <option value="text" class="textType" selected>Text</option>
                        <option value="image" class="imageType">Image</option>
                    </select>
                    <br />
                    <label for="contentValue">Content:</label><br />
                    <input type="text" class="value contentValue" name="contentValue" maxlength="500" />
                </fieldset>
                 <div class="add"><a href="#" class="addContent">Add another content</a></div>
            </fieldset>
            <fieldset>
                <legend>Answer</legend>
                <fieldset class="sprite" style="display:none">
                	<legend>Sprite</legend>
                    <input type="text" class="value spriteValue" name="spriteValue" maxlength="500" />
                </fieldset>
                <fieldset class="answer">
                	<label for="correct">Correct</label>
                	<input type="checkbox" name="correct" class="correct" /><br />
                    <label for="answerType">Type:</label>
                    <select name="answerType" class="answerType">
                        <option value="text" class="textType" selected>Text</option>
                        <option value="image" class="imageType">Image</option>
                        <option value="sprite" class="spriteType">Sprite</option>
                    </select>
                    <br />
                    <label for="answerValue">Content:</label><br />
                    <input type="text" class="value answerValue" name="answerValue" maxlength="500" />
                </fieldset>
                <fieldset class="answer">
                	<label for="correct">Correct</label>
                	<input type="checkbox" name="correct" class="correct" /><br />
                    <label for="answerType">Type:</label>
                    <select name="answerType" class="answerType">
                        <option value="text" class="textType" selected>Text</option>
                        <option value="image" class="imageType">Image</option>
                        <option value="sprite" class="spriteType">Sprite</option>
                    </select>
                    <br />
                    <label for="answerValue">Content:</label><br />
                    <input type="text" class="value answerValue" name="answerValue" maxlength="500" />
                </fieldset>
                 <div class="add"><a href="#" class="addAnswer">Add another answer</a></div>
            </fieldset>
            <div style="text-align:center">
            <button type="submit" class="generateBtn ui-button">Generate JSON</button>
            </div>
            <fieldset>
            	<legend>Output</legend>
                <div class="output"><pre><code></code></pre></div>
            </fieldset>
        </fieldset>
    </form>
</div>
<script type="text/javascript">
	var error = false;
	$(document).ready(function() {
		$("fieldset, input").addClass("ui-corner-all");
		$(".generateBtn").button({ icons: { primary: "ui-icon-script" } });
		$(".addStamp").click(function(e) {
            e.preventDefault();
			$delete = $("<a href='#'>Delete</a>").click(function(e) {
                e.preventDefault();
				$(this).parent("fieldset").remove();
            });
			$(".timestamp").first().clone().insertBefore($(this).parent("div")).append($delete);
        });
		$(".addContent").click(function(e) {
			e.preventDefault();
			$delete = $("<a href='#'>Delete</a>").click(function(e) {
                e.preventDefault();
				$(this).parent("fieldset").remove();
            });
            $(".vignette").first().clone().insertBefore($(this).parent("div")).append($delete);
        });
		$(".addAnswer").click(function(e) {
            e.preventDefault();
			$delete = $("<a href='#'>Delete</a>").click(function(e) {
                e.preventDefault();
				$(this).parent("fieldset").children(".answerType").val("text").trigger("change");
				$(this).parent("fieldset").remove();
            });
			$(".answer").first().clone(true).insertBefore($(this).parent("div")).append($delete);
        });
		var hasSprite = false;
		$(".answerType").change(function(e) {
			hasSprite = false;
			$(".answerType").each(function(index, element) {
                if ($(this).val() == "sprite") {
					hasSprite = true;
					return;
				}
            });
			if (hasSprite)
				$(".sprite").show();
			else
				$(".sprite").hide();
        });
        $(".generateBtn").click(function(e) {
            e.preventDefault();
			$(".errorMsg").remove();
			error = false;
			var question = {};
			if ($(".id").val().length == 0)
				ErrorMessage("error", "Question ID required", $(".id"));
			question["id"] = $(".id").val();
			var stamp = new Array();
			$(".timestamp").each(function(index, element) {
				if ($(element).children(".stamp").val().length > 0)
                	stamp.push($(element).children(".stamp").val());
            });
			if (stamp.length > 0)
				question["stamp"] = stamp;
			else
				ErrorMessage("warning", "No lecture ID. User will always have this question in list", $(".timestamp"));
			var vignette = new Array();
			$(".vignette").each(function(index, element) {
				var content = {};
				content["type"] = $(element).children(".contentType").val();
				content["content"] = $(element).children(".contentValue").val();
                if ($(element).children(".contentValue").val().length > 0)
					vignette.push(content);
				else
					ErrorMessage("warning", "Blank entry will not be included", $(element).children(".contentValue"));
            });
			if (vignette.length == 0)
				ErrorMessage("error", "Question has no content", $(".addContent").parent("div"));
			question["vignette"] = vignette;
			if (hasSprite) {
				if ($(".spriteValue").val().length == 0)
					ErrorMessage("error", "Sprite required", $(".spriteValue"));
				question["sprite"] = {"content": $(".spriteValue").val()};
			}
			var answer = new Array();
			if ($(".answer .correct:checked").length < 1) {
				ErrorMessage("error", "No correct answer", $(".answer .correct"));
			}
			else if($(".answer .correct:checked").length > 1)
				ErrorMessage("warning", "More than 1 correct answers", $(".answer .correct:checked"));
			$(".answer").each(function(index, element) {
                var content = {};
				content["type"] = $(element).children(".answerType").val();
				content["correct"] = $(element).children(".correct").is(":checked") ? "true": "false";
				content["content"] = $(element).children(".answerValue").val();
				if ($(element).children(".answerValue").val().length > 0)
					answer.push(content);
				else
					ErrorMessage("warning", "Blank entry will not be included", $(element).children(".answerValue"));
            });
			if (answer.length == 0)
				ErrorMessage("error", "Question should have at least 2 choices", $(".addAnswer").parent("div"));
			question["answer"] = answer;
			if (error) {
				$(".output pre code").html("Error occured");
			}
			else {
				$(".output pre code").html(JSON.stringify(question, null, 2));
			}
			hljs.highlightBlock($(".output pre code").get(0));
        });
    });
	
	function ErrorMessage(type, msg, $target) {
		if (type == "error") {
			error = true;
			$("<div></div>").insertAfter($target).addClass("errorMsg ui-state-error ui-corner-all ui-button ui-button-text-icon-primary").html(type + ": " + msg).append("<span class='ui-button-icon-primary ui-icon ui-icon-alert' style='margin-right: .3em;'></span>");
		}
		else
			$("<div></div>").insertAfter($target).addClass("errorMsg ui-state-highlight ui-corner-all ui-button ui-button-text-icon-primary").html(type + ": " + msg).append("<span class='ui-button-icon-primary ui-icon ui-icon-info' style='margin-right: .3em;'></span>");
	}
</script>
</body>
</html>
